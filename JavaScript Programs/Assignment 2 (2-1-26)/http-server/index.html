<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>File Upload</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
  </head>
  <body>
    <div class="container py-4">
      <h1 class="mb-3">File Upload</h1>

      <div class="mb-3 fw-bold" id="time">Loading Australia time...</div>

      <input type="file" id="fileInput" class="form-control mb-2" />
      <button id="uploadBtn" class="btn btn-primary">Upload</button>

      <div class="progress my-3">
        <div id="progressBar" class="progress-bar" style="width: 0%">0%</div>
      </div>

      <div id="msg"></div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <script>
      /*const timeBox = document.getElementById("time");

axios.get("http://localhost:3000/time").then(res => {
  timeBox.innerText = "Australia Time: " + res.data.australiaTime;
});*/

      const timeBox = document.getElementById("time");

      const source = new EventSource("http://localhost:3000/time-stream");

      source.onmessage = (e) => {
        timeBox.innerText = "Australia Time: " + e.data;
      };

      const fileInput = document.getElementById("fileInput");
      const uploadBtn = document.getElementById("uploadBtn");
      const progressBar = document.getElementById("progressBar");
      const msg = document.getElementById("msg");

      uploadBtn.addEventListener("click", async () => {
        const file = fileInput.files[0];
        if (!file) return alert("Select a file");

        const data = new FormData();
        data.append("file", file);

        try {
          await axios.post("http://localhost:3000/upload", data, {
            onUploadProgress: (e) => {
              const percent = Math.round((e.loaded / e.total) * 100);
              progressBar.style.width = percent + "%";
              progressBar.innerText = percent + "%";
            },
          });

          msg.innerHTML = `<div class="alert alert-success">Upload complete!</div>`;
          progressBar.style.width = "0%";
          progressBar.innerText = "0%";
        } catch {
          msg.innerHTML = `<div class="alert alert-success">Upload complete!</div>`;
        }
      });
    </script>
  </body>
</html>
